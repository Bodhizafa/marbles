<!DOCTYPE html>
<head>
<title></title>
<script src="https://code.jquery.com/jquery-2.1.3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.1.0/gl-matrix.js"></script>
<script src="./marbles.js"></script>
<script src="./util.js"></script>
<script type="text/javascript"> 
"use strict";
// A Bucket of tests has a name and is a list of functions, 
// each of which is passed a pass() and fail() continuation.

var run_tests = function(bucketName, tests) {
    var nTests = tests.length;
    console.log("Running", bucketName, "of", nTests);
    var $bucket = $('<div class="bucket"></div>');
    $bucket.append('<span class="passed bin"></span><span class="failed bin"></span><span class="undone bin"></span>');
    $("#everything").append($bucket);
    console.log($("#everything"), $bucket);
    tests.forEach(function(test, idx) {
        var $sliver = $('<div class="sliver"></div>')
            .addClass("sliver")
            .css("background-color", random_color())
            .css("width", (100.0 / nTests) + "%");
        $sliver.appendTo($bucket.find(".undone"));
        
        var pass = function() {
            $sliver.appendTo($bucket.find(".passed"));
            console.log(bucketName + "[" + idx + "] PASSED");
        }
        var fail = function(msg) {
            $sliver.appendTo($bucket.find(".failed"));
            console.error(bucketName + "[" + idx + "] FAILED", msg);
        }
        test(pass, fail);
    });
}
</script> 
<script type="text/javascript"> 
"use strict";
$(document).ready(function(e) {
    // Fun tests
    run_tests("Testing Testing", function(n, secs) {
        var tests = [];
        for(var i = 0; i < n; i++) {
            tests[i] = (function(i) {
                return (function(pass, fail) {
                    window.setTimeout(pass, secs - 1000.0  * i / n * secs)
                })
            })(n - i);
        }
        return tests;
    }(5, 5));

    // Util tests
    run_tests("Class system", [
        function(pass, fail) {
            // Let's make a functor!... After this git commit.
        }, function(pass, fail) {
            // Try a test with two properties, a methods, and no other magic
            var CartPoint = Class(
                // Properties
                {"X": 0, "Y": 0}, 
                // Methods
                {  "magnitude": function(priv) {
                    return Math.sqrt(this.X * this.X + this.Y * this.Y);
                }}
                // No Constructor
            );
            var cp = CartPoint({"X": 10, "Y": 10});
            if (cp.X != 10) fail();
            if (cp.Y != 10) fail();
            // Ensure we have no two enumerable properties (X and Y)
            var props = [];
            Object.keys(cp).forEach(function(k) {
                props.push(k);
            });
            if (props.length != 2) fail();
            // In this case, our prototype should have 3, (X, Y, magnitude)
            props = [];
            for (var k in cp) {
                props.push(k);
            }
            if (props.length != 3) fail();
            if (!close_enough(cp.magnitude(), 14.1421, 0.0001)) fail();
            pass();
        }, function(pass, fail) {
            // Test as much as we can with the most boring object possible.
            var constructorThis = null;
            var Boilerplate = Class(
                // Properties
                {},
                // Methods
                {},
                // Constructor
                function(priv) {
                    constructorThis = this;
                }
            )
            // Make sure that 'this' is correct in constructors 
            var b = Boilerplate();
            if (b !== constructorThis) fail();
            // Make sure we can't add properties willy-nilly
            try {
                b.berf = "berf";
                fail() // We should throw in the line above.
            } catch (e) {
            }
            // Ensure we have no own enumerable properties
            var props = [];
            Object.keys(b).forEach(function(k) {
                props.push(k);
            });
            if (props.length > 0) fail();
            // In this case, our prototype shouldn't have any enumerable properties either
            props = [];
            for (var k in b) {
                props.push(k);
            }
            if (props.length > 0) fail();
            pass();
        }
    ]);

});
</script>
</head>
<style type="text/css">
body {
    background-color: #002;
    color: #0ff;
    margin: 0;
    text-align: center;
    font-family: sans-serif;
}
.bucket {
    border: 1px solid #FFF;
    background-color: #000;
}
.bucket .sliver {
    border-bottom-width: 12px;
    border-bottom-style: solid;
    margin: 0;
    padding: 0;
}
.passed .sliver {
    border-bottom-color: #0F0 !important;
}
.failed .sliver {
    border-bottom-color: #F00
}
.undone .sliver {
    border-bottom-color: #00F;
}
.sliver {
    background-color: #eee;
    display: inline-block;
    margin: 0;
    padding: 0;
    width: 0;
    height: 32pt;
}
#everything {
}
h4 {
    color: #F0F;
}
</style>
<body>
<h4>.:THE WAY OF THE FUTURE:.</h4>
<div id="everything" class="container">
</div>
</body>
</html>
